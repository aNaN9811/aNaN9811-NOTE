# 内存管理



枚举：一个枚举成员变量相当于一个对象，一个对象占用 12 字节大小的对象头和对象本身大小，最后 8 字节对齐



## 内存的基础知识

内存是什么？有什么作用？

内存是用于存放数据的硬件，程序执行前需要先放到内存中才能被CPU处理。

区分内存的位置：给内存的存储单元编地址，每个地址对应一个存储单元（一小块内存）

按字节编址 -- 每个存储单元大小为1字节

| 输入换算数字 | 换算设置 |               |
| ------------ | -------- | ------------- |
| Bit位        | Bit      | 小数保留 位   |
| 字节         | Byte     | 1Byte= 8 Bit  |
| 千字节       | KB       | 1KB= 1024Byte |
| 兆字节       | MB       | 1MB= 1024KB   |
| 吉字节       | GB       | 1GB= 1024MB   |
| 太字节       | TB       | 1TB= 1024GB   |



## 无存储器抽象

1. 内存中每次只存在一个运行的程序在内存
2. 将内存划分成块，每个块有一个保护键存在 CPU 特殊的寄存器中，访问内存需 PSW 码（程序状态字）与保护键（只有操作系统可以修改）相同
   问题：两个程序应用了绝对物理地址
   解决：静态重定位技术

缺点：破坏操作系统；同时运行多个程序困难



## 存储器抽象

物理内存解决：存储器抽象 -- 地址空间

### 地址空间

地址空间：是一个进程可用于寻址内存的一套地址集合（连续的空闲内存），每个进程拥有独立的地址空间，一些特殊情况下会有共享的地址空间

动态重定位：一个程序起始物理地址装载到基址寄存器，程序长度装载到界限寄存器，程序执行时，每次一个进程访问一次内存，CPU 先自动把基址值加上后才传到内存总线上，同时检查程序地址是否超过界限寄存器的值

问题：每次访问内存都需要加法（耗时）和比较（不是很耗时）运算

### 交换技术

物理内存不够大解决：交换技术，虚拟内存

交换技术：把一个进程完整调入内存，使该进程运行一段时间，然后写回磁盘，空闲进程都存放在磁盘，所以不占用内存

交换会产生空闲区，通过进程下移课减少空闲区数量（内存紧缩），但会耗费大量 CPU 时间

分配进程内存：固定大小；按进程大小分配

问题：进程空间增长

### 空闲内存管理

跟踪内存使用情况：位图；空闲区链表

分配单元越大越好，此时位图越小

进程若不是分配内存单元的整数倍，那么就会有一定量的内存被浪费

内存大小、分配单元大小共同决定了位图大小

提供了可以利用一块固定大小的内存区域记录内存使用情况（跟踪内存的大小）

